<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Problem · Quantized System Solver</title><meta name="title" content="Problem · Quantized System Solver"/><meta property="og:title" content="Problem · Quantized System Solver"/><meta property="twitter:title" content="Problem · Quantized System Solver"/><meta name="description" content="Documentation for Quantized System Solver."/><meta property="og:description" content="Documentation for Quantized System Solver."/><meta property="twitter:description" content="Documentation for Quantized System Solver."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Quantized System Solver logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Quantized System Solver</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="../../guide/userTutorial/">Tutorial</a></li><li><a class="tocitem" href="../../guide/userAPI/">User API</a></li></ul></li><li><span class="tocitem">Background</span><ul><li><a class="tocitem" href="../../background/introductoryResources/">Introduction to Quantized System Methods</a></li><li><a class="tocitem" href="../../background/qss/">Quantized State System Methods</a></li><li><a class="tocitem" href="../../background/liqss/">Linearly Implicit Quantized State System Methods</a></li><li><a class="tocitem" href="../../background/mliqss/">Modified Linearly Implicit Quantized State System Methods</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/linearTimeInvariantSystem/">Linear Time Invariant</a></li><li><a class="tocitem" href="../../examples/linearTimeInvariantSystemEvents/">Linear Time Invariant with events</a></li><li><a class="tocitem" href="../../examples/vanderpol/">Van der Pol</a></li><li><a class="tocitem" href="../../examples/tysonModel/">The Tyson Model</a></li><li><a class="tocitem" href="../../examples/adr/">ADR problem</a></li><li><a class="tocitem" href="../../examples/dosing/">Conditional Dosing in Pharmacometrics</a></li></ul></li><li><span class="tocitem">Developer resources</span><ul><li><a class="tocitem" href="../devIntro/">Developer Guide</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">IR model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../normalize_ir/">Normalize_IR</a></li><li><a class="tocitem" href="../intermediateRepresentation/">IR</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox" checked/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">problem construction</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Problem</a><ul class="internal"><li><a class="tocitem" href="#Problem-extension"><span>Problem extension</span></a></li><li><a class="tocitem" href="#Further-reading-about-the-functions-creating-the-problem"><span>Further reading about the functions creating the problem</span></a></li><li><a class="tocitem" href="#Helper-packages"><span>Helper packages</span></a></li></ul></li><li><a class="tocitem" href="../problemFunction/">Problem Function</a></li><li><a class="tocitem" href="../problem_references/">Problem Internals</a></li></ul></li><li><a class="tocitem" href="../algorithm/">QSS Algorithms</a></li><li><a class="tocitem" href="../solve/">Solve</a></li><li><a class="tocitem" href="../integrator/">Integrators</a></li><li><a class="tocitem" href="../quantizer/">Quantizer</a></li><li><a class="tocitem" href="../solution/">Solution</a></li><li><a class="tocitem" href="../taylor/">Taylor Variables</a></li><li><a class="tocitem" href="../utils/">Utils references</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developer resources</a></li><li><a class="is-disabled">problem construction</a></li><li class="is-active"><a href>Problem</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Problem</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mongibellili/QuantizedSystemSolver.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/mongibellili/QuantizedSystemSolver.jl/blob/main/docs/src/developer/problem.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Problem"><a class="docs-heading-anchor" href="#Problem">Problem</a><a id="Problem-1"></a><a class="docs-heading-anchor-permalink" href="#Problem" title="Permalink"></a></h1><p>The ODEProblem function is the entry point for defining a new problem to be solved by the QSS solver. It takes user-provided code, which includes system parameters, variables, equations, and event logic, and constructs a Problem object that encapsulates all the necessary information for the solver to simulate the system such as problem dimensions, dependencies, and equations. The function works by parsing the user code and extracting relevant data to populate the Problem object.</p><h2 id="Problem-extension"><a class="docs-heading-anchor" href="#Problem-extension">Problem extension</a><a id="Problem-extension-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-extension" title="Permalink"></a></h2><p>Problem extension can be achieved easily via PRTYPE which is of type Val, or another subtype of this superclass can be created.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QuantizedSystemSolver.ODEProblemData" href="#QuantizedSystemSolver.ODEProblemData"><code>QuantizedSystemSolver.ODEProblemData</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ODEProblemData{F,PRTYPE,T,D,Z,CS}</code></pre><p>This is a superclass for all ODE problems. It is parametric on:</p><ul><li>The problem type PRTYPE.</li><li>The number of continuous variables T</li><li>The number of discrete events D</li><li>The number of events (zero crossing functions) Z</li><li>The cache size CS.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mongibellili/QuantizedSystemSolver.jl/blob/41debd13396e9e7eb49f93aafade8bd5327cbb47/src/qssAbstractTypes.jl#L2-L11">source</a></section></article><h3 id="What-is-needed-with-a-new-problem:"><a class="docs-heading-anchor" href="#What-is-needed-with-a-new-problem:">What is needed with a new problem:</a><a id="What-is-needed-with-a-new-problem:-1"></a><a class="docs-heading-anchor-permalink" href="#What-is-needed-with-a-new-problem:" title="Permalink"></a></h3><p>The more different the new problem from the <code>ODEContProblem</code>, the more functions are needed to be extended. In general the following functions need to be extended.</p><ul><li>The <code>odeProblemFunc</code> method to handle this problem.</li><li>The <code>integrate</code> method for this new type of problem.</li><li>The <code>custom_Solve</code> method if needed.</li></ul><h3 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h3><pre><code class="language-julia hljs">struct SmallODEProblem{CS}&lt;: ODEProblemData{0,1,1,0,0,CS} 
  cacheSize::Val{CS}# CS= cache size 
  initConditions::Float64   
  eq::Function#function that holds the differential equation
end</code></pre><p>This new problem type takes care of one differential equation. There is no need for the Jacobian nor for the dependencies. This needs an extension of the custom_Solve method that just removes the references to the <code>jac</code> and the <code>SD</code>. An extension of the integrate method is also needed since the implementation is a lot simpler than what is currently implemented.</p><h2 id="Further-reading-about-the-functions-creating-the-problem"><a class="docs-heading-anchor" href="#Further-reading-about-the-functions-creating-the-problem">Further reading about the functions creating the problem</a><a id="Further-reading-about-the-functions-creating-the-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Further-reading-about-the-functions-creating-the-problem" title="Permalink"></a></h2><p><em>ODEDiscProblem{F,PRTYPE,T,D,Z,CS}:</em> This is the struct that holds all the necessary data for a nonlinear ordinary differential equation (ODE)  problem with discrete events. The structure includes various fields such as initial conditions, discrete variables, Jacobians, event dependencies, and other data related to how the problem is formulated. This structure serves as the core data holder for the problem and will be used in the solver. It is a parametric abstract type that has the following parameters:</p><p>PRTYPE: The type of the problem (to distinguish between various types, and allow future extension of the solver to handle new types).</p><p>T: The number of continuous variables (state variables).</p><p>Z: The number of zero-crossing functions, which are used to detect events.</p><p>Y: The actual number of events.</p><p>CS: Cache size, which is used to store intermediate operations.</p><p>The use of abstract types in this context allows for flexibility and extensibility in the solver. By defining these abstract types, the code can be easily adapted to handle different types of problems, algorithms, and solutions without needing to modify the core solver logic. This design choice enhances the maintainability and scalability of the solver, making it easier to add new features or support additional problem types in the future.</p><p><strong>odeProblemFunc:</strong> After an initial preparation performed by the The NLodeProblem function, The function odeProblemFunc takes the resulting expressions to continue constructing an instance of the ODEDiscProblem structure. It works in several key stages:</p><p><em>Initialization:</em> The function begins by initializing vectors and dictionaries that will hold equations (equs), Jacobian dependencies (jac), zero-crossing functions (ZCjac), and event dependencies. These serve to store the different types of equations and their relationships.</p><p><em>Processing ODEs:</em> It loops through each of the ODE expressions provided by the user. Depending on the type of expression (discrete variables, differential equations, or loop constructs), it processes the right-hand side (RHS) of the equation. For differential equations, it extracts dependencies to build the Jacobian and transform the equations into a more appropriate form for further use. Special cases are handled, such as if the RHS is a number or a symbol.</p><p><em>Handling Events:</em> The function also processes event-related constructs (if conditions) that correspond to different points where the system might undergo discrete changes. It process the RHS of the event equations, transforms them into a suitable form, and builds the necessary dependency structures. Specifically, it constructs how discrete and continuous variables influence one another through the events.</p><p><em>Constructing the Function Code:</em> After processing all ODEs and events, the function dynamically generates a Julia function code needed to store the system of ODEs and events. This code is built into a function that handles different cases (i.e., which equation to evaluate based on an index of a state change or an event).</p><p><strong>Building Dependencies:</strong> Several helper functions that build the dependencies between variables, events. They build dependency vectors  that track how discrete and continous variables influence the system. This is used to know what variables to update and determine when specific events should be checked. By tracking the relationships between variables and events, the solver can determine the appropriate actions to take at each time step. The dependencies are stored in the following vectors:</p><p>-<span>$jac$</span>: It determines which variables affect a derivative.</p><p>-<span>$ZCjac$</span>: It determines which variables affect a zero-crossing function.</p><p>-<span>$SD$</span>: It determines which derivatives that are affected by a given variable.</p><p>-<span>$SZ$</span>: It determines which zero-crossing functions that are affected by a given variable.</p><p>-<span>$HZ$</span>: It tells which Zero-crossing functions influenced by a given event.</p><p>-<span>$HD$</span>: It tells which derivatives influenced by a given event.</p><p>Here&#39;s a quick summary and what each helper function is doing:</p><p><em>extractJacDepNormal:</em> It Extracts the dependencies for normal (non-loop) expressions. It updates the Jacobian matrix <span>$jac$</span> and a dictionary <span>$dD$</span> for tracking dependencies of derivatives to discrete variables.</p><p><em>extractJacDepLoop:</em> Similar to extractJacDepNormal, but specifically for loop expressions. It tracks dependencies across loop iterations.</p><p><em>extractZCJacDep:</em> It Extracts zero-crossing Jacobian dependencies for discrete variables (<span>$dZ$</span>), and it updates <span>$zcjac$</span>, <span>$SZ$</span>.</p><p><em>createDependencyToEventsDiscr:</em> It maps discrete dependencies (dD, dZ) to specific events, it and constructs dependency matrices HZ and HD from the discrete variables only.</p><p><em>createDependencyToEventsCont:</em> Similar to createDependencyToEventsDiscr, but for continuous dependencies (SD, sZ), and it updates the matrices HZ and HD from the continuous variables only.</p><p><em>unionDependency:</em> Merges the two previous sets of dependencies (continuous and discrete) into the final matrices HZ and HD.</p><h2 id="Helper-packages"><a class="docs-heading-anchor" href="#Helper-packages">Helper packages</a><a id="Helper-packages-1"></a><a class="docs-heading-anchor-permalink" href="#Helper-packages" title="Permalink"></a></h2><p>The 𝑝𝑜𝑠𝑡𝑤𝑎𝑙𝑘 function from the MacroTools.jl (Copyright (c) 2015: Mike Innes) package plugs parameters and helper functions directly into the equations, and traverses the right-hand side of differential equations and zero-crossing functions, facilitating the construction of the Jacobian matrix and identifying variable dependencies. It also transforms specific expressions like 𝑞[1] into 𝑞[1] [0] within events, and converts 𝑞[𝑖] to 𝑞𝑖, making the equations more tractable for differentiation and Jacobian construction. Additionally, the @𝑐𝑎𝑝𝑡𝑢𝑟𝑒 macro efficiently handles cases where differential equations are defined within a for loop. </p><p>The diff(basi, symarg) function from the SymEngine.jl (Copyright (c) 2015-2017 Isuru Fernando) package is applied to perform symbolic differentiation, where basi is an expression and symarg is the symbol with respect to which the derivative is taken. This returns the partial derivative of the expression, making it particularly useful for deriving system Jacobians. </p><p>@code_string macro from the CodeTracking.jl (Copyright (c) 2019 Tim Holy) is used to get the body expression of the function that holds the problem given by the user. </p><p>@RuntimeGeneratedFunction from the RuntimeGeneratedFunctions.jl package (Copyright (c) 2020 Chris Rackauckas) is used to avoid world-age issues with the generated functions.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../intermediateRepresentation/">« IR</a><a class="docs-footer-nextpage" href="../problemFunction/">Problem Function »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Saturday 12 July 2025 18:01">Saturday 12 July 2025</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
